{% extends "_base.html" %}

{% block extra_head %}
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
{% endblock %}

{% block content %}
<div class="py-3">
  <div class="card shadow-sm rounded-4 soft-card mb-3">
    <div class="card-body d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h1 class="h5 mb-1 fw-semibold">Graficos - {{ pair_label }}</h1>
        <div class="text-body-secondary small">Janela: {{ window }}d (linha)</div>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <div class="btn-group btn-group-sm" role="group" aria-label="Tipo de grafico">
          <button type="button" class="btn btn-outline-primary" id="btnLine">Linha</button>
          <button type="button" class="btn btn-outline-primary" id="btnCandle" {% if not candles_ready %}disabled{% endif %}>
            Candle
          </button>
        </div>
        <a class="btn btn-outline-primary btn-sm" href="{% url 'pairs:analysis_prices' %}?{{ request.GET.urlencode }}&refresh=1">
          Atualizar
        </a>
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'core:home' %}">
          Voltar para o inicio
        </a>
      </div>
    </div>
  </div>

  {% if mt5_error %}
    <div class="alert alert-warning small mb-3">
      Falha ao atualizar via MT5: {{ mt5_error }}
    </div>
  {% elif not candles_ready %}
    <div class="alert alert-info small mb-3">
      Candles indisponiveis: faltam dados OHLC para um dos ativos.
    </div>
  {% endif %}
  {% include "pairs/_analysis_charts.html" %}
</div>
{% endblock %}

{% block extra_js %}
{% include "pairs/_analysis_charts_script.html" %}
{% endblock %}
